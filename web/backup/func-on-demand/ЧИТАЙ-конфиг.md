# Дополнительные настройки

## FOD_FUNCS_DIRECTORY

Т.к. была уже установлена основная директория в конфиге, к ней можно подцепить еще несколько папок для сканирования. Это для того, чтобы допустим держать какие-то другие редкие функции в стороннем репозитории.

```php
define( 'FOD_FUNCS_DIRECTORY', K_THEME_DIR.'funcs-enabled/' );
```

Раскоментируйте строку —

```php
\trendoman\CmsFu\AutoloadFiltered::add_dir( K_SITE_DIR.'#CmsFu' );
```

— в данном случае подгрузятся функции с указанной папки в корне сайта. Можно указать несколько папок, продублировав строку.


```php
\trendoman\CmsFu\AutoloadFiltered::add_dir( K_SITE_DIR.'#CmsFu' );
\trendoman\CmsFu\AutoloadFiltered::add_dir( K_SITE_DIR.K_SNIPPETS_DIR.'/newfuncs' );
```

Главное - правильно поставить разделители `/`, т.к. K_SITE_DIR уже имеет его на конце, а K_SNIPPETS_DIR нет.

---

**Важное:** Не беспокойся за скорость сканирования. Когда функция найдена, плагин запоминает уже просканированные места и в следующий раз продолжит с того же места, где закончил прошлый раз. Просканированные папки закешированы т.е. всё будет очень быстро.

## FOD_FILE_EXTENSION

Эта настройка меняет расширение файлов с ".func" на любое другое.

```php
define( 'FOD_FILE_EXTENSION', 'inc' );
```

Несколько расширений не получится сделать, только одно значение поддерживается.

## FOD_USE_COUCHCACHE

CouchCMS по умолчанию кеширует кусочки кода (snippets) в базе данных (в распарсенном виде) для более быстрой генерации страницы. Если используется кешированный сниппет, то система проверит время последнего изменения файла и прочитает файл только если он новее. Если поставить ***0***, то будем читать функции всегда только с диска, что облегчает отладку кода функции (полезно когда вы пишете новую).

```php
define( 'FOD_USE_COUCHCACHE', 1 );
```

Основная настройка, которая может отменить данную, находится в системном файле `couch/header.php`, строки 62,63:

```php
define( 'K_CACHE_OPCODES', '1' );
define( 'K_CACHE_SETTINGS', '1' );
```

Кеш хранится в строках таблицы `couch_settings`. Если она становится слишком велика, можно отключить всё это. Полезно когда у вас сотни функций.

## FOD_PRELOAD_PATHS

Если использовать эту настройку, то можно полностью исключить поиск файлов на диске. Плагин прочитает подготовленный файл со списком готовых путей к функциям и всё :). Подготовить список путей можно просканировав выбранную папку разок с помощью тега, уже включенного в плагин:

Вставьте в любое место на странице, поставив нужный путь:

```xml
<cms:gen_func_array "<cms:show k_theme_path />funcs-available/" />
```

Откройте страницу, чтобы код запустился. Тег выплюнет список найденных функций в виде PHP массива. Скопируйте этот массив в файл `config-paths.php`, перезаписав там всё. Пример:


```php
<?php

return
array (
  'name' => 'mysnippets/funcs/name.func',
  'show-ms' => 'mysnippets/funcs/DateTime/show-ms/show-ms.func',
);
```

Размер массива уже не имеет значения, там могут быть сотни и тысячи путей. Это значительно сбережет время на поиск функции. Если какая-то функция не будет найдена в списке, её поищем тогда на диске.


```php
define( 'FOD_PRELOAD_PATHS', 1 );
```

Эта настройка заставляет плагин пред-регистрировать все функции до их возможного вызова. Слегка замедляет загрузку страницы.

## FOD_CACHE_FILE_ON

Альтернатива кешированию в базе данных - это файловый кеш. Так можно зарегистрировать кучу функций за раз с помощью одного файла. Причем, кеш-файл содержит функции уже в пропарсенном виде, т.е. без исходного кода (это важно иногда).

Разместите тег и выполните один раз на странице

```xml
<cms:gen_func_cache />
```

Тег ничего не ищет сам, он только берет уже зарегистрированные функции (следовательно, спарсенные) и дампит их в файл. После запуска тег покажет количество записанных функций в файле `funcs.dat.md`. Файл можно открыть и почитать, т.к. тег автоматически сгенерировал сигнатуру функции и записал в формате Markdown.

Удалите тег после генерации и проставьте ***1*** в настройку.
```php
define( 'FOD_CACHE_FILE_ON', 1 );
```

Плагин прочитает кеш и закинет его в CouchCMS. Это очень быстрый способ зарегистрировать множество функций.

В следующей настройке можно задать другое имя файлу.

## FOD_CACHE_FILE

```php
define( 'FOD_CACHE_FILE', 'funcs.dat.md' );
```

Последняя строчка в файле это строка валидации содержимого, поэтому ручное редактирование файла недопустимо - он не пройдет хеш-контроль.

## Автор

Пишите по любым вопросам

Антон С.\
tony.smirnov@gmail.com
