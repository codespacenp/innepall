# `<cms:swap>`

Заменяет, вырезает, вставляет строки в текст. Поддерживает автозамену в массивах и Регулярные выражения.

```xml
<cms:swap val='mr.' with='Mr.'><cms:show mytext /></cms:swap>
<cms:swap val='mr.' with='Mr.' text=mytext />
```

Можно использовать в двух вариантах, но приоритет отдаётся параметру **text** а не вложенному контенту, если используется и то и то в одном теге.

## Параметры

* **val** – строка, массив строк или шаблон регулярки - это будет искомое
* **with** – строка, массив или регулярка - то, на что делаем замену (замены).
* **is_regex** – ставим ***1*** если **val** это регулярка или массив регулярок – ***0*** (стандарт) или ***1***
* **trim** – значение ***1*** (***0*** это стандарт) подрезает по краям пробелы в исходном тексте до замены
* **text** – исходный текст, в котором надо что-то менять (искать)
* **into** – имя для переменной в которую надо загнать результат без печати. Создадим новую или запишем в существующую переменную
* **scope** – видимость переменной (***global***, ***parent***).

## ПРИМЕРЫ

### Простая замена - тег на тег

Задача поменять "pre" на "code" в HTML строке.

```html
<pre style="color:darkblue">$a = 5;</pre>
```

Для выполнения простой замены нужно менять со скобкой. Вот какие есть варианты:

#### с массивом строк

```xml
<cms:set arr_search = '["<pre", "</pre>"]' is_json='1'/>
<cms:set arr_replace = '["<code", "</code>"]' is_json='1'/>
<cms:swap val=arr_search with=arr_replace><pre style="color:darkblue">$a = 5;</pre></cms:swap>
```

> Result:\
> ```<code style="color:darkblue">$a = 5;</code>```

#### или с вложенным тегом

```xml
<cms:swap val='<pre' with='<code'>
  <cms:swap val='</pre' with='</code'>
    <pre style="color:darkblue">$a = 5;</pre>
  </cms:swap>
</cms:swap>
```

> Result:\
> ```<code style="color:darkblue">$a = 5;</code>```

#### ну или регуляркой 8-)

```xml
<cms:swap val='~<(/)?pre~' with='<$1code' is_regex='1'><pre style="color:darkblue">$a = 5;</pre></cms:swap>
```

## ЕЩЕ ПРИМЕРЫ

### меняем пробел на подчеркивание

Выводим ***default_value*** вместо ***Default value***

```xml
<cms:swap val='~\s~' with='_' is_regex='1'><cms:show 'Default value' case='lower' /></cms:swap>
```

### оставляем только деньги (цифры)

```xml
<cms:swap val='/[^0-9.]/' with='' is_regex='1'>$ 123.00</cms:swap>
```

> Result:\
> **123.00**

### текст в HTML

```xml
<cms:swap val='/(\r\n)?\s*(\w*):\s*(\w*)/' with='$1<b>$2</b>: $3<br>$1' is_regex='1'>
  key1: value1
  key2: value2
</cms:swap>
```

> Result:
> ```html
> <b>key1</b>: value1<br>
> <b>key2</b>: value2<br>
> ```
> HTML preview:
> <pre>
> <b>key1</b>: value1
> <b>key2</b>: value2


### Краткая справка по регуляркам

Эти символы служебные и должны экранироваться если их надо использовать для замены как буквы:

```txt
\ ^ . $ | ( ) [ ]
* + ? { } ,
```

<details><summary><strong>Справка по спец. символам</strong></summary>

Без перевода.
<pre>
\ Quote the next metacharacter
^ Match the beginning of the line
. Match any character (except newline)
$ Match the end of the line (or before newline at the end)
| Alternation
() Grouping
[] Character class
* Match 0 or more times
+ Match 1 or more times
? Match 1 or 0 times
{n} Match exactly n times
{n,} Match at least n times
{n,m} Match at least n but not more than m times

More Special Character Stuff

\t tab (HT, TAB)
\n newline (LF, NL)
\r return (CR)
\w Match a "word" character (alphanumeric plus "_")
\W Match a non-word character
\s Match a whitespace character
\S Match a non-whitespace character
\d Match a digit character
\D Match a non-digit character
\b Match a word boundary
\B Match a non-(word boundary)
</pre>

</details>

## И ЕЩЕ ПРИМЕРЫ

```xml
<!-- setting vars for example -->
<cms:set myvar='1' />
<cms:set name='myvar' />
<!-- begin -->
<cms:capture into='dynatext'>
    <#cms:if <cms:show name /> eq '1'>Yes<#cms:else/>No</#cms:if>
</cms:capture>
<!-- run "dynatext" as code -->
<cms:embed code="<cms:swap val='#cms:' with='cms:' text=dynatext />" />
```

> Result:\
> Yes

#### несложный пример который исполняет подготовленный текст как код

```xml
<cms:if myvar eq '1'>Yes<cms:else />No</cms:if>
```

#### удаляем "LIMIT" из SQL запроса

```xml
<cms:swap val='~(LIMIT.*$)~' with='' is_regex='1' text=sql/>
```

#### удаляем часть запроса SQL

```xml
<cms:swap val='AND p.parent_id=0' with=' ' text=k_sql_where />
```

Эта часть отвечает за черновики и слегка замедляет ответ базы

#### меняем запрещенные символы на пробелы

```xml
<cms:set chars = '[ "=", "|" ]' is_json='1' />
<cms:swap val=chars with=' ' text=k_page_title />
```

Это помогает создать список вариантов для `opt_select`

#### делаем "безопасный" текст заменяя на дефис всё, что не буквы-цифры

```xml
<cms:swap val='~\W~' with='-' is_regex='1' trim='1' text=k_page_title />
```

#### вернём нормальные кавычки

```xml
<cms:swap val='&quot;' with='"' text=pk0 />
```

#### сотрём комментарии из невалидного неправильного JSON

```xml
<cms:swap val='~\/\/.*~' with='' is_regex='1'>{
   "id"      :"",  // k_page_id
   "title"   :""   // k_page_title
}
</cms:swap>
```

## Функции в тему

* **Converters » trim-tags**
* **Money » inr-format**

## Теги в тему

- **Tweakus-Dilectus Tags » hilite**
- **Tweakus-Dilectus Tags » transliterate_ru**
- **Tweakus-Dilectus Tags » arr_filter_values**

## Автор

Пишите по любым вопросам, докидывайте свои примеры.

Антон С.\
tony.smirnov@gmail.com
